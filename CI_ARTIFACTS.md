# CI Artifacts Guide

This document explains how to access and use the artifacts generated by our CI/CD pipelines.

## üì¶ Available Artifacts

### Main CI Pipeline (`.github/workflows/ci.yml`)

**Triggers:** Pull requests, pushes to main/master

| Artifact Name | Contents | Retention | Description |
|---------------|----------|-----------|-------------|
| `reports` | JSON reports, logs | 7 days | ESLint, TypeScript, test results |
| `playwright-report` | HTML test report | 7 days | Interactive Playwright test results |
| `playwright-artifacts` | Traces, videos, screenshots | 7 days | Debug artifacts for failed tests |
| `vitest-results` | Unit test results | 7 days | Vitest JSON output |

### Nightly E2E Pipeline (`.github/workflows/e2e-nightly.yml`)

**Triggers:** Daily at 02:00 UTC, manual dispatch

| Artifact Name | Contents | Retention | Description |
|---------------|----------|-----------|-------------|
| `playwright-report-nightly` | HTML test report | 14 days | Nightly test results (includes @flaky tests) |
| `playwright-artifacts-nightly` | Traces, videos, screenshots | 14 days | Debug artifacts for nightly failures |

### Windows E2E Pipeline (`.github/workflows/e2e-win.yml`)

**Triggers:** Pull requests to main/develop, manual dispatch

| Artifact Name | Contents | Retention | Description |
|---------------|----------|-----------|-------------|
| `playwright-report-windows` | HTML test report | 10 days | Windows-specific test results |
| `playwright-artifacts-windows` | Traces, videos, screenshots | 10 days | Windows debug artifacts |

## üîç Accessing Artifacts

### From GitHub UI

1. **Navigate to the workflow run:**
   - Go to the repository's "Actions" tab
   - Click on the specific workflow run
   - Scroll down to the "Artifacts" section

2. **Download artifacts:**
   - Click on the artifact name to download
   - Extract the ZIP file locally
   - Open `playwright-report/index.html` in your browser

### From Command Line

```bash
# Download artifacts using GitHub CLI
gh run download <run-id> --dir ./artifacts

# Or download specific artifact
gh run download <run-id> --name playwright-report --dir ./playwright-report
```

### Local Development

```bash
# Generate local Playwright report
pnpm exec playwright show-report

# Generate local test results
pnpm run test:e2e:json
pnpm run test:unit:json
```

## üìä Understanding Reports

### Playwright HTML Report

The Playwright HTML report provides:

- **Test Results Overview:** Pass/fail counts, duration
- **Test Details:** Individual test results with steps
- **Traces:** Interactive step-by-step execution
- **Videos:** Recorded test execution (for failures)
- **Screenshots:** Captured at failure points
- **Timeline:** Test execution timeline

**Key Sections:**
- **Overview:** Summary statistics
- **Suites:** Test file organization
- **Tests:** Individual test results
- **Attachments:** Traces, videos, screenshots

### Vitest Results

The Vitest JSON output includes:

- Test file paths and names
- Pass/fail status for each test
- Execution duration
- Error messages and stack traces
- Coverage information (if enabled)

### ESLint Results

The ESLint JSON report contains:

- File paths with issues
- Rule violations
- Severity levels (error, warning)
- Line and column numbers
- Fix suggestions

## üêõ Debugging Failed Tests

### Using Playwright Traces

1. **Download the `playwright-artifacts` artifact**
2. **Extract and open `playwright-report/index.html`**
3. **Click on a failed test**
4. **Click "Trace" to open the interactive trace viewer**
5. **Step through the test execution to identify issues**

### Using Videos

1. **Navigate to the test result in the HTML report**
2. **Click on the video thumbnail**
3. **Watch the test execution to see what went wrong**

### Using Screenshots

1. **Find the failed test in the HTML report**
2. **Look at the "Attachments" section**
3. **Click on screenshots to see the state at failure**

## üîß Local Development

### Running Tests Locally

```bash
# Run all tests
pnpm run test:all

# Run E2E tests only
pnpm run test:e2e

# Run unit tests only
pnpm run test:unit

# Run with UI (debug mode)
pnpm run test:e2e:ui

# Run specific test file
pnpm exec playwright test playwright/tests/smoke.spec.ts
```

### Generating Local Reports

```bash
# Generate Playwright HTML report
pnpm exec playwright show-report

# Generate JSON reports
pnpm run test:e2e:json
pnpm run test:unit:json
pnpm run lint:json
```

### Viewing Local Artifacts

```bash
# Open Playwright report
pnpm exec playwright show-report

# View test results directory
ls -la test-results/

# View Playwright report directory
ls -la playwright-report/
```

## üìà Monitoring Test Health

### Key Metrics to Watch

1. **Test Pass Rate:** Should be >95% for stable tests
2. **Flaky Test Count:** Monitor @flaky tests in nightly runs
3. **Test Duration:** Watch for performance regressions
4. **Artifact Size:** Large artifacts may indicate issues

### Nightly Test Analysis

The nightly pipeline runs all tests including @flaky ones:

- **Green:** All tests pass
- **Yellow:** Some @flaky tests fail (expected)
- **Red:** Stable tests failing (investigate)

### PR Test Analysis

The PR pipeline excludes @flaky tests:

- **Green:** All stable tests pass
- **Red:** Stable tests failing (block merge)

## üö® Troubleshooting

### Common Issues

1. **Artifacts not found:**
   - Check if the workflow run completed
   - Verify artifact retention period hasn't expired
   - Ensure the workflow step didn't fail

2. **Large artifact sizes:**
   - Videos and traces can be large
   - Consider reducing video quality in config
   - Check for memory leaks in tests

3. **Missing test results:**
   - Verify test commands are running
   - Check for test configuration issues
   - Look at workflow logs for errors

### Getting Help

1. **Check workflow logs** for detailed error messages
2. **Review test configuration** in `playwright.config.ts`
3. **Run tests locally** to reproduce issues
4. **Check the artifacts** for debugging information

## üìù Best Practices

### For Contributors

1. **Always check artifacts** when tests fail
2. **Use local development** to debug before pushing
3. **Review @flaky test failures** in nightly runs
4. **Keep test artifacts** for debugging complex issues

### For Maintainers

1. **Monitor artifact retention** to avoid storage issues
2. **Review nightly test trends** for flaky test patterns
3. **Update documentation** when adding new artifacts
4. **Clean up old artifacts** periodically

## üîó Related Documentation

- [RUN_AND_VERIFY.md](./RUN_AND_VERIFY.md) - Local development guide
- [TASKS.md](./TASKS.md) - Project task management
- [Playwright Documentation](https://playwright.dev/docs/test-reporters) - Official Playwright docs
- [Vitest Documentation](https://vitest.dev/guide/reporters.html) - Official Vitest docs
