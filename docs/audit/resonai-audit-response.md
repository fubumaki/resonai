# Resonai Audit Response Plan

## Context
- The latest project report flagged gaps in the isolation, privacy, and offline architecture proofs even though the online security posture (strict CSP, COOP/COEP headers) remains intact.【F:PROJECT_REPORT.md†L139-L178】
- Ship-gate SLOs treat privacy, isolation, and offline readiness as go/no-go criteria, so every remediation must preserve the local-first guarantees documented for the practice flow.【F:docs/slo-budgets.md†L30-L75】
- This response maps each audit issue to accountable owners and code areas while anchoring follow-up decisions to the governance log in `docs/DECISIONS.md`.

## Audit Acceptance Checklist
- [x] Isolation: Confirm `window.crossOriginIsolated === true` in Firefox both online and after an offline reload under service worker control (run `pnpm playwright test isolation_headers.spec.ts --project=firefox`).

## Issue Matrix
| Issue | Impact | Status | Recommended Owner(s) | Linked Areas / Docs | Notes & Next Actions |
| --- | --- | --- | --- | --- | --- |
| **Offline cross-origin isolation drops when served from cache** | Offline sessions fall out of `crossOriginIsolated`, disabling SharedArrayBuffer paths and weakening the security guarantees for AudioWorklets.【F:PROJECT_REPORT.md†L139-L193】 | **Closed.** Service worker now reapplies COOP/COEP headers before returning cached navigations, and the `/practice` offline regression keeps cross-origin isolation intact.【F:public/sw.js†L1-L75】【F:playwright/tests/isolation-offline-practice.spec.ts†L1-L74】 | Codex cloud (owns COOP/COEP enforcement per governance log).【F:docs/DECISIONS.md†L5-L54】 | `next.config.js` headers, `public/sw.js`, offline regression spec `playwright/tests/isolation-offline-practice.spec.ts`, reference SW patch in `snippets/sw.coopcoep.example.js`.【F:public/sw.js†L1-L75】【F:playwright/tests/isolation-offline-practice.spec.ts†L1-L74】【F:snippets/sw.coopcoep.example.js†L1-L86】 | Keep SSOT JSON summaries current whenever the service worker changes and cross-link the passing regression run under DECISIONS item 13.【F:.artifacts/SSOT.md†L1-L17】【F:docs/DECISIONS.md†L67-L75】 |
| **Worklet/model caching incomplete** | Audio worklets and models fail to load offline, blocking drills and risking regression of SLOs around offline readiness.【F:PROJECT_REPORT.md†L174-L193】【F:docs/slo-budgets.md†L30-L75】 | **Pending decision.** Offline caching strategy still unratified.【F:docs/DECISIONS.md†L67-L75】 | Codex cloud (offline caching + SW strategy).【F:docs/DECISIONS.md†L67-L75】 | `scripts/build-precache.js`, `public/sw.js` precache list, DECISIONS item 13.【F:scripts/build-precache.js†L1-L125】【F:public/sw.js†L1-L55】【F:docs/DECISIONS.md†L67-L75】 | Finalize the APP_SHELL inventory for worklets/onnx assets, ensure CORP/CORP headers survive caching, and document the outcome under DECISIONS item 13 before closing the audit finding.【F:docs/DECISIONS.md†L67-L75】 |
| **Data & Privacy UX regression** | QA cannot confirm privacy guarantees because the `/data` explainer content intermittently fails visibility checks, weakening user-facing privacy disclosures.【F:RUN_AND_VERIFY.md†L5-L20】【F:playwright/tests/smoke.spec.ts†L193-L207】 | **Open.** Playwright smoke test currently failing on this assertion.【F:RUN_AND_VERIFY.md†L5-L20】 | Cursor (UI remediation) with ChatGPT partnering on policy copy per local-first plan.【F:docs/DECISIONS.md†L55-L57】 | `app/data/page.tsx` content, footer link routing, smoke spec expectations.【F:app/data/page.tsx†L1-L33】【F:playwright/tests/smoke.spec.ts†L193-L207】 | Audit root cause (layout classes vs. visibility), restore reliable rendering under strict CSP, and reconfirm copy against the local-first policy once fixed. Update DECISIONS entry 9 with any policy tweaks.【F:docs/DECISIONS.md†L55-L57】 |
| **Analytics beacon verification failing** | Without confirmed event delivery, operators lose observability on mic permissions and activation funnels, risking blind spots in privacy-safe telemetry commitments.【F:RUN_AND_VERIFY.md†L5-L20】【F:playwright/tests/analytics_beacon.spec.ts†L1-L52】 | **Open.** Beacon spec failing to observe expected events.【F:RUN_AND_VERIFY.md†L5-L20】 | Codex cloud (local analytics schema owner).【F:docs/DECISIONS.md†L85-L86】 | `/try` flow analytics stubs, `app/api/events/route.ts` in-memory sink, analytics helper utilities.【F:app/api/events/route.ts†L1-L130】【F:playwright/tests/analytics_beacon.spec.ts†L1-L52】 | Inspect client buffering vs. POST handler, extend diagnostics around sendBeacon fallback, and document schema/retention guarantees under DECISIONS item 19 before re-running the spec.【F:docs/DECISIONS.md†L85-L86】 |
| **Inline-style backlog threatens CSP posture** | Remaining inline styles keep the door open to CSP regressions (potential XSS) and block the strict `style-src 'self'` policy used across the app.【F:docs/DECISIONS.md†L7-L13】【F:TASKS.md†L12-L37】 | **In progress.** Waves 2 & 4 of the removal plan still outstanding.【F:TASKS.md†L18-L37】 | Cursor (UI refactors) with Codex reviewing CSP compliance.【F:AGENTS.md†L12-L23】 | Components listed in `TASKS.md` (e.g., `components/ProgressBar.tsx`, `app/data/page.tsx`), lint rule upgrade in `eslint.config.mjs`.【F:TASKS.md†L18-L37】 | Finish wave 2/4 migrations, elevate the lint rule to error, and record any allowed exceptions in the CSP hardening decision entry.【F:docs/DECISIONS.md†L7-L13】 |

## Governance Linkage
All remediation updates must be logged under the existing decision record for "Security posture and testing workflow" and the pending mini-spec entries covering privacy and offline caching so that future contributors can trace compliance back to this audit. Link each PR to [`docs/DECISIONS.md`](../DECISIONS.md#2025-09-14--security-posture-and-testing-workflow) when closing the associated checklist items.【F:docs/DECISIONS.md†L5-L99】

